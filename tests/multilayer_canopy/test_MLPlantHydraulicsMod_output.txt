============================= test session starts ==============================
platform linux -- Python 3.11.13, pytest-9.0.2, pluggy-1.6.0 -- /burg-archive/home/mck2199/clm-ml-jax/jax-agents/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /burg-archive/home/mck2199/clm-ml-jax
configfile: pytest.ini
plugins: cov-7.0.0, anyio-4.12.0
collecting ... collected 44 items

../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_shapes[test_nominal_single_patch_single_layer] PASSED [  2%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_shapes[test_nominal_multi_patch_multi_layer] PASSED [  4%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_shapes[test_nominal_dense_canopy] PASSED [  6%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_shapes[test_edge_zero_soil_resistance] PASSED [  9%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_shapes[test_edge_zero_plant_area_index] PASSED [ 11%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_shapes[test_edge_very_high_soil_resistance] PASSED [ 13%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_shapes[test_edge_minimal_canopy_height] PASSED [ 15%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_shapes[test_special_sparse_canopy] PASSED [ 18%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_shapes[test_special_tall_canopy_extreme] PASSED [ 20%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_shapes[test_special_mixed_pft_types] PASSED [ 22%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_values_positive[test_nominal_single_patch_single_layer] FAILED [ 25%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_values_positive[test_nominal_multi_patch_multi_layer] FAILED [ 27%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_values_positive[test_nominal_dense_canopy] FAILED [ 29%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_zero_dpai_gives_zero_conductance PASSED [ 31%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_high_soil_resistance_reduces_conductance PASSED [ 34%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_dtypes PASSED [ 36%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_gravitational_effect PASSED [ 38%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestSoilResistance::test_soil_resistance_shapes[test_nominal_single_column] PASSED [ 40%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestSoilResistance::test_soil_resistance_shapes[test_edge_frozen_soil] PASSED [ 43%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestSoilResistance::test_soil_resistance_shapes[test_edge_shallow_bedrock] PASSED [ 45%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestSoilResistance::test_soil_resistance_positive_values PASSED [ 47%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestSoilResistance::test_soil_resistance_negative_water_potential PASSED [ 50%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestSoilResistance::test_soil_resistance_uptake_fractions_sum_to_one PASSED [ 52%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestSoilResistance::test_soil_resistance_uptake_fractions_in_range PASSED [ 54%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestSoilResistance::test_soil_resistance_frozen_soil_increases_resistance PASSED [ 56%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestSoilResistance::test_soil_resistance_shallow_bedrock_limits_uptake PASSED [ 59%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestSoilResistance::test_soil_resistance_dtypes PASSED [ 61%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestLeafWaterPotential::test_leaf_water_potential_shapes[test_nominal_sunlit_leaves-0] PASSED [ 63%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestLeafWaterPotential::test_leaf_water_potential_shapes[test_nominal_shaded_leaves-1] PASSED [ 65%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestLeafWaterPotential::test_leaf_water_potential_shapes[test_edge_zero_transpiration-0] PASSED [ 68%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestLeafWaterPotential::test_leaf_water_potential_shapes[test_edge_high_water_stress-0] PASSED [ 70%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestLeafWaterPotential::test_leaf_water_potential_negative_values PASSED [ 72%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestLeafWaterPotential::test_leaf_water_potential_sunlit_more_negative PASSED [ 75%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestLeafWaterPotential::test_leaf_water_potential_zero_transpiration_equilibrium FAILED [ 77%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestLeafWaterPotential::test_leaf_water_potential_high_stress_limits PASSED [ 79%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestLeafWaterPotential::test_leaf_water_potential_capacitance_effect PASSED [ 81%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestLeafWaterPotential::test_leaf_water_potential_dtypes PASSED [ 84%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestLeafWaterPotential::test_leaf_water_potential_valid_leaf_index[0] PASSED [ 86%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestLeafWaterPotential::test_leaf_water_potential_valid_leaf_index[1] PASSED [ 88%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestIntegration::test_full_hydraulic_pathway FAILED [ 90%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestIntegration::test_conservation_of_water_flux PASSED [ 93%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestNumericalStability::test_plant_resistance_no_nan_inf FAILED [ 95%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestNumericalStability::test_soil_resistance_no_nan_inf PASSED [ 97%]
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestNumericalStability::test_leaf_water_potential_no_nan_inf FAILED [100%]/burg-archive/home/mck2199/clm-ml-jax/jax-agents/.venv/lib64/python3.11/site-packages/coverage/control.py:957: CoverageWarning: No data was collected. (no-data-collected); see https://coverage.readthedocs.io/en/7.13.0/messages.html#warning-no-data-collected
  self._warn("No data was collected.", slug="no-data-collected")


=================================== FAILURES ===================================
_ TestPlantResistance.test_plant_resistance_values_positive[test_nominal_single_patch_single_layer] _
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py:495: in test_plant_resistance_values_positive
    mock_lsc = jnp.abs(jnp.random.normal(50.0, 10.0, (n_patches, n_levcan)))
                       ^^^^^^^^^^
E   AttributeError: module 'jax.numpy' has no attribute 'random'
_ TestPlantResistance.test_plant_resistance_values_positive[test_nominal_multi_patch_multi_layer] _
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py:495: in test_plant_resistance_values_positive
    mock_lsc = jnp.abs(jnp.random.normal(50.0, 10.0, (n_patches, n_levcan)))
                       ^^^^^^^^^^
E   AttributeError: module 'jax.numpy' has no attribute 'random'
_ TestPlantResistance.test_plant_resistance_values_positive[test_nominal_dense_canopy] _
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py:495: in test_plant_resistance_values_positive
    mock_lsc = jnp.abs(jnp.random.normal(50.0, 10.0, (n_patches, n_levcan)))
                       ^^^^^^^^^^
E   AttributeError: module 'jax.numpy' has no attribute 'random'
_ TestLeafWaterPotential.test_leaf_water_potential_zero_transpiration_equilibrium _
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py:964: in test_leaf_water_potential_zero_transpiration_equilibrium
    assert lwp_val >= init_val, (
E   AssertionError: LWP should increase toward psis with zero transpiration
E   assert -0.550000011920929 >= -0.5
_________________ TestIntegration.test_full_hydraulic_pathway __________________
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py:1147: in test_full_hydraulic_pathway
    assert mock_leaf_output.lwp.shape[0] == plant_inputs.ncan[0], (
E   AssertionError: Leaf water potential should match number of canopy layers
E   assert 1 == Array(3, dtype=int32)
___________ TestNumericalStability.test_plant_resistance_no_nan_inf ____________
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py:1199: in test_plant_resistance_no_nan_inf
    mock_lsc = jnp.abs(jnp.random.normal(50.0, 10.0, (n_patches, n_levcan)))
                       ^^^^^^^^^^
E   AttributeError: module 'jax.numpy' has no attribute 'random'
_________ TestNumericalStability.test_leaf_water_potential_no_nan_inf __________
../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py:1241: in test_leaf_water_potential_no_nan_inf
    mock_lwp = -jnp.abs(jnp.random.normal(1.0, 0.3, (n_patches, n_canopy_layers, 2)))
                        ^^^^^^^^^^
E   AttributeError: module 'jax.numpy' has no attribute 'random'
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.11.13-final-0 _______________

Name                                                Stmts   Miss  Cover   Missing
---------------------------------------------------------------------------------
src/jax_agents/__init__.py                              6      6     0%   7-14
src/jax_agents/base_agent.py                          114    114     0%   7-386
src/jax_agents/prompts/__init__.py                      3      3     0%   3-6
src/jax_agents/prompts/repair_prompts.py                1      1     0%   11
src/jax_agents/prompts/test_prompts_simplified.py       1      1     0%   8
src/jax_agents/prompts/translation_prompts_v2.py        1      1     0%   3
src/jax_agents/repair_agent.py                        169    169     0%   13-453
src/jax_agents/test_agent.py                          133    133     0%   11-335
src/jax_agents/translator.py                          277    277     0%   8-891
src/jax_agents/utils/__init__.py                        2      2     0%   3-5
src/jax_agents/utils/config_loader.py                  21     21     0%   3-69
---------------------------------------------------------------------------------
TOTAL                                                 728    728     0%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
=========================== short test summary info ============================
FAILED ../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_values_positive[test_nominal_single_patch_single_layer] - AttributeError: module 'jax.numpy' has no attribute 'random'
FAILED ../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_values_positive[test_nominal_multi_patch_multi_layer] - AttributeError: module 'jax.numpy' has no attribute 'random'
FAILED ../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestPlantResistance::test_plant_resistance_values_positive[test_nominal_dense_canopy] - AttributeError: module 'jax.numpy' has no attribute 'random'
FAILED ../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestLeafWaterPotential::test_leaf_water_potential_zero_transpiration_equilibrium - AssertionError: LWP should increase toward psis with zero transpiration
assert -0.550000011920929 >= -0.5
FAILED ../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestIntegration::test_full_hydraulic_pathway - AssertionError: Leaf water potential should match number of canopy layers
assert 1 == Array(3, dtype=int32)
FAILED ../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestNumericalStability::test_plant_resistance_no_nan_inf - AttributeError: module 'jax.numpy' has no attribute 'random'
FAILED ../tests/multilayer_canopy/test_MLPlantHydraulicsMod.py::TestNumericalStability::test_leaf_water_potential_no_nan_inf - AttributeError: module 'jax.numpy' has no attribute 'random'
========================= 7 failed, 37 passed in 3.73s =========================
