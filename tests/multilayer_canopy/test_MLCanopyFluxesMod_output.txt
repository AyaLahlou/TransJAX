============================= test session starts ==============================
platform linux -- Python 3.11.13, pytest-9.0.2, pluggy-1.6.0 -- /burg-archive/home/mck2199/clm-ml-jax/jax-agents/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /burg-archive/home/mck2199/clm-ml-jax
configfile: pytest.ini
plugins: cov-7.0.0, anyio-4.12.0
collecting ... collected 31 items

../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_input_physical_constraints[test_nominal_single_patch_moderate_conditions] PASSED [  3%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_input_physical_constraints[test_nominal_multiple_patches_varying_lai] PASSED [  6%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_input_physical_constraints[test_edge_zero_lai_bare_ground] PASSED [  9%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_input_physical_constraints[test_edge_nighttime_no_solar_radiation] PASSED [ 12%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_input_physical_constraints[test_edge_extreme_cold_winter_conditions] PASSED [ 16%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_input_physical_constraints[test_edge_high_lai_dense_canopy] PASSED [ 19%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_input_physical_constraints[test_special_single_substep] PASSED [ 22%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_input_physical_constraints[test_special_many_substeps_fine_temporal] PASSED [ 25%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_input_physical_constraints[test_special_high_wind_low_pressure] PASSED [ 29%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_input_physical_constraints[test_special_hot_dry_desert_conditions] PASSED [ 32%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_output_shapes[test_nominal_single_patch_moderate_conditions] PASSED [ 35%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_output_shapes[test_nominal_multiple_patches_varying_lai] PASSED [ 38%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_output_shapes[test_edge_zero_lai_bare_ground] PASSED [ 41%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_output_shapes[test_edge_nighttime_no_solar_radiation] PASSED [ 45%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_output_dtypes[test_nominal_single_patch_moderate_conditions] PASSED [ 48%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_output_dtypes[test_edge_high_lai_dense_canopy] PASSED [ 51%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_zero_lai_behavior PASSED [ 54%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_nighttime_zero_solar PASSED [ 58%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_extreme_cold_conditions PASSED [ 61%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_extreme_heat_conditions PASSED [ 64%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_high_lai_dense_canopy PASSED [ 67%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_single_substep PASSED [ 70%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_many_substeps PASSED [ 74%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_high_wind_low_pressure PASSED [ 77%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_bounds_consistency PASSED [ 80%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_lai_sai_fraction_sums FAILED [ 83%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_timestep_consistency PASSED [ 87%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_atmospheric_forcing_dimensions PASSED [ 90%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_canopy_state_dimensions PASSED [ 93%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_metadata_completeness PASSED [ 96%]
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_test_data_coverage PASSED [100%]/burg-archive/home/mck2199/clm-ml-jax/jax-agents/.venv/lib64/python3.11/site-packages/coverage/control.py:957: CoverageWarning: No data was collected. (no-data-collected); see https://coverage.readthedocs.io/en/7.13.0/messages.html#warning-no-data-collected
  self._warn("No data was collected.", slug="no-data-collected")


=================================== FAILURES ===================================
__________________________ test_lai_sai_fraction_sums __________________________
../tests/multilayer_canopy/test_MLCanopyFluxesMod.py:1072: in test_lai_sai_fraction_sums
    assert jnp.allclose(dpai_sums[non_zero_lai], 1.0, atol=0.05), \
E   AssertionError: test_nominal_single_patch_moderate_conditions: dpai fractions should sum to ~1.0
E   assert Array(False, dtype=bool)
E    +  where Array(False, dtype=bool) = <PjitFunction of <function allclose at 0x1554f64f9940>>(Array([2.], dtype=float32), 1.0, atol=0.05)
E    +    where <PjitFunction of <function allclose at 0x1554f64f9940>> = jnp.allclose
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.11.13-final-0 _______________

Name                                                Stmts   Miss  Cover   Missing
---------------------------------------------------------------------------------
src/jax_agents/__init__.py                              6      6     0%   7-14
src/jax_agents/base_agent.py                          114    114     0%   7-386
src/jax_agents/prompts/__init__.py                      3      3     0%   3-6
src/jax_agents/prompts/repair_prompts.py                1      1     0%   11
src/jax_agents/prompts/test_prompts_simplified.py       1      1     0%   8
src/jax_agents/prompts/translation_prompts_v2.py        1      1     0%   3
src/jax_agents/repair_agent.py                        169    169     0%   13-453
src/jax_agents/test_agent.py                          133    133     0%   11-335
src/jax_agents/translator.py                          277    277     0%   8-891
src/jax_agents/utils/__init__.py                        2      2     0%   3-5
src/jax_agents/utils/config_loader.py                  21     21     0%   3-69
---------------------------------------------------------------------------------
TOTAL                                                 728    728     0%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
=========================== short test summary info ============================
FAILED ../tests/multilayer_canopy/test_MLCanopyFluxesMod.py::test_lai_sai_fraction_sums - AssertionError: test_nominal_single_patch_moderate_conditions: dpai fractions should sum to ~1.0
assert Array(False, dtype=bool)
 +  where Array(False, dtype=bool) = <PjitFunction of <function allclose at 0x1554f64f9940>>(Array([2.], dtype=float32), 1.0, atol=0.05)
 +    where <PjitFunction of <function allclose at 0x1554f64f9940>> = jnp.allclose
========================= 1 failed, 30 passed in 6.73s =========================
