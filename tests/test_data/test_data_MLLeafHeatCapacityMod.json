{
  "function_name": "leaf_heat_capacity",
  "test_cases": [
    {
      "name": "test_nominal_single_patch_single_layer",
      "inputs": {
        "slatop": [
          0.015
        ],
        "ncan": [
          1
        ],
        "dpai": [
          [
            2.5
          ]
        ],
        "cpbio": 1470.0,
        "cpliq": 4188.0,
        "fcarbon": 0.5,
        "fwater": 0.7
      },
      "expected_output": [
        [
          17458.33
        ]
      ],
      "metadata": {
        "type": "nominal",
        "description": "Single patch, single canopy layer with typical forest parameters",
        "edge_cases": [],
        "physical_context": "Typical temperate forest canopy with moderate LAI"
      }
    },
    {
      "name": "test_nominal_multi_patch_multi_layer",
      "inputs": {
        "slatop": [
          0.012,
          0.018,
          0.02
        ],
        "ncan": [
          3,
          2,
          4
        ],
        "dpai": [
          [
            1.5,
            1.2,
            0.8
          ],
          [
            2.0,
            1.5,
            0.0
          ],
          [
            1.8,
            1.6,
            1.4,
            1.0
          ]
        ],
        "cpbio": 1470.0,
        "cpliq": 4188.0,
        "fcarbon": 0.5,
        "fwater": 0.7
      },
      "expected_output": null,
      "metadata": {
        "type": "nominal",
        "description": "Multiple patches with varying canopy layers representing different vegetation types",
        "edge_cases": [],
        "physical_context": "Mixed forest stand with different species (conifer, broadleaf, shrub)"
      }
    },
    {
      "name": "test_nominal_grassland_low_lai",
      "inputs": {
        "slatop": [
          0.025,
          0.03
        ],
        "ncan": [
          2,
          2
        ],
        "dpai": [
          [
            0.5,
            0.3
          ],
          [
            0.8,
            0.4
          ]
        ],
        "cpbio": 1470.0,
        "cpliq": 4188.0,
        "fcarbon": 0.5,
        "fwater": 0.7
      },
      "expected_output": null,
      "metadata": {
        "type": "nominal",
        "description": "Grassland/crop canopy with high SLA and low LAI",
        "edge_cases": [],
        "physical_context": "Agricultural or grassland ecosystem with thin leaves"
      }
    },
    {
      "name": "test_edge_zero_dpai",
      "inputs": {
        "slatop": [
          0.015,
          0.02
        ],
        "ncan": [
          3,
          2
        ],
        "dpai": [
          [
            0.0,
            0.0,
            0.0
          ],
          [
            1.5,
            0.0
          ]
        ],
        "cpbio": 1470.0,
        "cpliq": 4188.0,
        "fcarbon": 0.5,
        "fwater": 0.7
      },
      "expected_output": null,
      "metadata": {
        "type": "edge",
        "description": "Zero plant area index in some or all layers (bare ground or gaps)",
        "edge_cases": [
          "zero_dpai"
        ],
        "physical_context": "Sparse canopy or winter deciduous forest, should return zero heat capacity"
      }
    },
    {
      "name": "test_edge_very_small_slatop",
      "inputs": {
        "slatop": [
          0.001,
          0.0005
        ],
        "ncan": [
          2,
          2
        ],
        "dpai": [
          [
            1.0,
            0.5
          ],
          [
            1.2,
            0.8
          ]
        ],
        "cpbio": 1470.0,
        "cpliq": 4188.0,
        "fcarbon": 0.5,
        "fwater": 0.7
      },
      "expected_output": null,
      "metadata": {
        "type": "edge",
        "description": "Very small SLA representing extremely thick leaves (succulents)",
        "edge_cases": [
          "small_sla"
        ],
        "physical_context": "Succulent plants or sclerophyllous vegetation with very thick leaves"
      }
    },
    {
      "name": "test_edge_very_large_slatop",
      "inputs": {
        "slatop": [
          0.05,
          0.08
        ],
        "ncan": [
          2,
          3
        ],
        "dpai": [
          [
            2.0,
            1.5
          ],
          [
            1.8,
            1.2,
            0.6
          ]
        ],
        "cpbio": 1470.0,
        "cpliq": 4188.0,
        "fcarbon": 0.5,
        "fwater": 0.7
      },
      "expected_output": null,
      "metadata": {
        "type": "edge",
        "description": "Very large SLA representing extremely thin leaves",
        "edge_cases": [
          "large_sla"
        ],
        "physical_context": "Shade-adapted understory plants with very thin leaves"
      }
    },
    {
      "name": "test_edge_extreme_fwater_boundary",
      "inputs": {
        "slatop": [
          0.015
        ],
        "ncan": [
          2
        ],
        "dpai": [
          [
            1.5,
            1.0
          ]
        ],
        "cpbio": 1470.0,
        "cpliq": 4188.0,
        "fcarbon": 0.5,
        "fwater": 0.95
      },
      "expected_output": null,
      "metadata": {
        "type": "edge",
        "description": "Very high water fraction near upper boundary (succulent-like)",
        "edge_cases": [
          "high_fwater"
        ],
        "physical_context": "Water-rich tissue approaching physical limits, tests numerical stability"
      }
    },
    {
      "name": "test_edge_low_fwater",
      "inputs": {
        "slatop": [
          0.015
        ],
        "ncan": [
          2
        ],
        "dpai": [
          [
            1.5,
            1.0
          ]
        ],
        "cpbio": 1470.0,
        "cpliq": 4188.0,
        "fcarbon": 0.5,
        "fwater": 0.1
      },
      "expected_output": null,
      "metadata": {
        "type": "edge",
        "description": "Very low water fraction (desiccated leaves)",
        "edge_cases": [
          "low_fwater"
        ],
        "physical_context": "Drought-stressed or senescent leaves with minimal water content"
      }
    },
    {
      "name": "test_special_high_lai_dense_canopy",
      "inputs": {
        "slatop": [
          0.01
        ],
        "ncan": [
          5
        ],
        "dpai": [
          [
            3.5,
            3.0,
            2.5,
            2.0,
            1.5
          ]
        ],
        "cpbio": 1470.0,
        "cpliq": 4188.0,
        "fcarbon": 0.5,
        "fwater": 0.7
      },
      "expected_output": null,
      "metadata": {
        "type": "special",
        "description": "Dense tropical forest canopy with many layers and high LAI",
        "edge_cases": [],
        "physical_context": "Multi-layered tropical rainforest with LAI > 10"
      }
    },
    {
      "name": "test_special_varying_physical_parameters",
      "inputs": {
        "slatop": [
          0.015,
          0.02
        ],
        "ncan": [
          2,
          2
        ],
        "dpai": [
          [
            2.0,
            1.5
          ],
          [
            1.8,
            1.2
          ]
        ],
        "cpbio": 1200.0,
        "cpliq": 4188.0,
        "fcarbon": 0.45,
        "fwater": 0.65
      },
      "expected_output": null,
      "metadata": {
        "type": "special",
        "description": "Non-default physical parameters representing different tissue composition",
        "edge_cases": [],
        "physical_context": "Alternative biomass composition (e.g., nitrogen-rich leaves, different lignin content)"
      }
    }
  ],
  "test_cases_simple_function": [
    {
      "name": "test_simple_nominal_default_params",
      "inputs": {
        "slatop": [
          0.015,
          0.02
        ],
        "dpai": [
          [
            2.0,
            1.5
          ],
          [
            1.8,
            1.2
          ]
        ],
        "params": {
          "cpbio": 1470.0,
          "cpliq": 4188.0,
          "fcarbon": 0.5,
          "fwater": 0.7
        }
      },
      "expected_output": null,
      "metadata": {
        "type": "nominal",
        "description": "Simple function with default parameters",
        "edge_cases": []
      }
    },
    {
      "name": "test_simple_edge_zero_dpai_all_layers",
      "inputs": {
        "slatop": [
          0.015
        ],
        "dpai": [
          [
            0.0,
            0.0,
            0.0
          ]
        ],
        "params": {
          "cpbio": 1470.0,
          "cpliq": 4188.0,
          "fcarbon": 0.5,
          "fwater": 0.7
        }
      },
      "expected_output": [
        [
          0.0,
          0.0,
          0.0
        ]
      ],
      "metadata": {
        "type": "edge",
        "description": "All layers have zero PAI, should return all zeros",
        "edge_cases": [
          "zero_dpai"
        ]
      }
    },
    {
      "name": "test_simple_special_single_value_broadcast",
      "inputs": {
        "slatop": [
          0.015
        ],
        "dpai": [
          [
            1.5
          ]
        ],
        "params": {
          "cpbio": 1470.0,
          "cpliq": 4188.0,
          "fcarbon": 0.5,
          "fwater": 0.7
        }
      },
      "expected_output": null,
      "metadata": {
        "type": "special",
        "description": "Minimal dimensions (1x1) to test broadcasting",
        "edge_cases": []
      }
    }
  ],
  "validation_data": {
    "manual_calculation_example": {
      "description": "Hand-calculated example for verification",
      "inputs": {
        "slatop": 0.015,
        "dpai": 2.5,
        "cpbio": 1470.0,
        "cpliq": 4188.0,
        "fcarbon": 0.5,
        "fwater": 0.7
      },
      "calculation_steps": {
        "lma": "1 / 0.015 * 0.001 = 0.06667 kg C / m2",
        "dry_weight": "0.06667 / 0.5 = 0.13333 kg DM / m2",
        "fresh_weight": "0.13333 / (1 - 0.7) = 0.44444 kg FM / m2",
        "leaf_water": "0.7 * 0.44444 = 0.31111 kg H2O / m2",
        "cpleaf_per_m2_leaf": "1470 * 0.13333 + 4188 * 0.31111 = 196.0 + 1302.8 = 1498.8 J/K/m2 leaf",
        "cpleaf_total": "1498.8 * 2.5 = 3747.0 J/K/m2 ground (but output is per m2 leaf, so 1498.8)"
      },
      "note": "Output is per m2 leaf area, not per m2 ground area"
    }
  },
  "notes": "Test data generation strategy:\n\n1. **Nominal cases (50%)**: Generated using typical values from literature for different biomes:\n   - Temperate forests: SLA ~0.010-0.020 m2/gC, LAI 2-6\n   - Tropical forests: SLA ~0.008-0.015 m2/gC, LAI 4-10\n   - Grasslands/crops: SLA ~0.020-0.040 m2/gC, LAI 0.5-4\n   - Default physical parameters from CLM/FATES models\n\n2. **Edge cases (30%)**: Focus on boundary conditions:\n   - Zero dpai: Tests handling of bare ground/gaps\n   - Extreme SLA values: 0.0005 (succulents) to 0.080 (shade leaves)\n   - Water fraction boundaries: 0.1 (desiccated) to 0.95 (near upper limit)\n   - Tests numerical stability near division by zero (1-fwater)\n\n3. **Special cases (20%)**: Unusual but valid scenarios:\n   - Dense multi-layer canopies (5+ layers)\n   - Non-default physical parameters\n   - Minimal dimensions for broadcasting tests\n\n4. **Dimension consistency**: All test cases maintain proper array shapes:\n   - slatop: (n_patches,)\n   - ncan: (n_patches,) with integer values\n   - dpai: (n_patches, n_levels) with ragged arrays padded appropriately\n\n5. **Physical realism**:\n   - All temperatures implicitly > 0K (heat capacities positive)\n   - Fractions strictly in [0,1]\n   - SLA > 0 (cannot have zero or negative leaf area per carbon)\n   - dpai >= 0 (plant area index non-negative)\n\n6. **Expected outputs**: Calculated where simple (e.g., zero dpai \u2192 zero output), otherwise left as null for pytest to compute and validate properties (non-negative, correct shape, etc.)\n\n7. **JIT compilation**: All test cases work for both regular and JIT-compiled versions\n\n8. **Numerical precision**: Values chosen to avoid floating-point edge cases while testing physical boundaries"
}