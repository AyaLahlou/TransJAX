{
  "function_name": "canopy_nitrogen_profile",
  "test_cases": [
    {
      "name": "test_nominal_single_patch_c3_moderate_lai",
      "inputs": {
        "vcmaxpft": [
          62.0
        ],
        "c3psn": [
          1
        ],
        "tacclim": [
          293.15
        ],
        "dpai": [
          [
            0.5,
            0.4,
            0.3,
            0.2,
            0.1
          ]
        ],
        "kb": [
          [
            0.5,
            0.5,
            0.5,
            0.5,
            0.5
          ]
        ],
        "tbi": [
          [
            0.95,
            0.85,
            0.75,
            0.65,
            0.55
          ]
        ],
        "fracsun": [
          [
            0.8,
            0.7,
            0.6,
            0.5,
            0.4
          ]
        ],
        "clump_fac": [
          0.85
        ],
        "ncan": [
          5
        ],
        "lai": [
          1.5
        ],
        "sai": [
          0.5
        ],
        "params": null,
        "validate": true
      },
      "metadata": {
        "type": "nominal",
        "description": "Single C3 patch with moderate LAI, typical temperate conditions, 5 canopy layers",
        "edge_cases": []
      }
    },
    {
      "name": "test_nominal_multiple_patches_mixed_pathways",
      "inputs": {
        "vcmaxpft": [
          62.0,
          40.0,
          55.0
        ],
        "c3psn": [
          1,
          0,
          1
        ],
        "tacclim": [
          293.15,
          303.15,
          283.15
        ],
        "dpai": [
          [
            0.6,
            0.5,
            0.4,
            0.3,
            0.2
          ],
          [
            0.8,
            0.7,
            0.6,
            0.5,
            0.4
          ],
          [
            0.4,
            0.3,
            0.2,
            0.1,
            0.05
          ]
        ],
        "kb": [
          [
            0.5,
            0.5,
            0.5,
            0.5,
            0.5
          ],
          [
            0.6,
            0.6,
            0.6,
            0.6,
            0.6
          ],
          [
            0.4,
            0.4,
            0.4,
            0.4,
            0.4
          ]
        ],
        "tbi": [
          [
            0.9,
            0.8,
            0.7,
            0.6,
            0.5
          ],
          [
            0.85,
            0.75,
            0.65,
            0.55,
            0.45
          ],
          [
            0.95,
            0.88,
            0.8,
            0.72,
            0.65
          ]
        ],
        "fracsun": [
          [
            0.75,
            0.65,
            0.55,
            0.45,
            0.35
          ],
          [
            0.7,
            0.6,
            0.5,
            0.4,
            0.3
          ],
          [
            0.8,
            0.7,
            0.6,
            0.5,
            0.4
          ]
        ],
        "clump_fac": [
          0.85,
          0.75,
          0.9
        ],
        "ncan": [
          5,
          5,
          5
        ],
        "lai": [
          2.0,
          3.0,
          1.45
        ],
        "sai": [
          0.6,
          0.8,
          0.4
        ],
        "params": null,
        "validate": true
      },
      "metadata": {
        "type": "nominal",
        "description": "Three patches with mixed C3/C4 pathways, varying temperatures and LAI values",
        "edge_cases": []
      }
    },
    {
      "name": "test_nominal_high_lai_dense_canopy",
      "inputs": {
        "vcmaxpft": [
          80.0,
          70.0
        ],
        "c3psn": [
          1,
          1
        ],
        "tacclim": [
          298.15,
          295.15
        ],
        "dpai": [
          [
            1.2,
            1.0,
            0.9,
            0.8,
            0.7,
            0.6,
            0.5,
            0.4,
            0.3,
            0.2
          ],
          [
            1.0,
            0.9,
            0.8,
            0.7,
            0.6,
            0.5,
            0.4,
            0.3,
            0.2,
            0.1
          ]
        ],
        "kb": [
          [
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55
          ],
          [
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5
          ]
        ],
        "tbi": [
          [
            0.88,
            0.77,
            0.68,
            0.6,
            0.53,
            0.47,
            0.41,
            0.36,
            0.32,
            0.28
          ],
          [
            0.9,
            0.81,
            0.73,
            0.66,
            0.59,
            0.53,
            0.48,
            0.43,
            0.39,
            0.35
          ]
        ],
        "fracsun": [
          [
            0.65,
            0.55,
            0.48,
            0.42,
            0.37,
            0.32,
            0.28,
            0.24,
            0.21,
            0.18
          ],
          [
            0.7,
            0.6,
            0.52,
            0.45,
            0.39,
            0.34,
            0.3,
            0.26,
            0.23,
            0.2
          ]
        ],
        "clump_fac": [
          0.8,
          0.82
        ],
        "ncan": [
          10,
          10
        ],
        "lai": [
          6.6,
          5.5
        ],
        "sai": [
          1.2,
          1.0
        ],
        "params": null,
        "validate": true
      },
      "metadata": {
        "type": "nominal",
        "description": "Dense canopy with high LAI (6-7), 10 layers, typical for tropical forests",
        "edge_cases": []
      }
    },
    {
      "name": "test_edge_zero_lai_no_canopy",
      "inputs": {
        "vcmaxpft": [
          50.0,
          45.0
        ],
        "c3psn": [
          1,
          0
        ],
        "tacclim": [
          290.15,
          295.15
        ],
        "dpai": [
          [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0
          ],
          [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0
          ]
        ],
        "kb": [
          [
            0.5,
            0.5,
            0.5,
            0.5,
            0.5
          ],
          [
            0.5,
            0.5,
            0.5,
            0.5,
            0.5
          ]
        ],
        "tbi": [
          [
            1.0,
            1.0,
            1.0,
            1.0,
            1.0
          ],
          [
            1.0,
            1.0,
            1.0,
            1.0,
            1.0
          ]
        ],
        "fracsun": [
          [
            1.0,
            1.0,
            1.0,
            1.0,
            1.0
          ],
          [
            1.0,
            1.0,
            1.0,
            1.0,
            1.0
          ]
        ],
        "clump_fac": [
          1.0,
          1.0
        ],
        "ncan": [
          0,
          0
        ],
        "lai": [
          0.0,
          0.0
        ],
        "sai": [
          0.0,
          0.0
        ],
        "params": null,
        "validate": true
      },
      "metadata": {
        "type": "edge",
        "description": "Zero LAI/SAI representing bare ground or dormant vegetation",
        "edge_cases": [
          "zero_lai",
          "zero_dpai",
          "full_transmission"
        ]
      }
    },
    {
      "name": "test_edge_minimal_lai_single_layer",
      "inputs": {
        "vcmaxpft": [
          30.0
        ],
        "c3psn": [
          1
        ],
        "tacclim": [
          288.15
        ],
        "dpai": [
          [
            0.05
          ]
        ],
        "kb": [
          [
            0.5
          ]
        ],
        "tbi": [
          [
            0.975
          ]
        ],
        "fracsun": [
          [
            0.95
          ]
        ],
        "clump_fac": [
          0.95
        ],
        "ncan": [
          1
        ],
        "lai": [
          0.05
        ],
        "sai": [
          0.01
        ],
        "params": null,
        "validate": true
      },
      "metadata": {
        "type": "edge",
        "description": "Minimal LAI with single canopy layer, sparse vegetation",
        "edge_cases": [
          "minimal_lai",
          "single_layer"
        ]
      }
    },
    {
      "name": "test_edge_extreme_cold_temperature",
      "inputs": {
        "vcmaxpft": [
          40.0,
          35.0
        ],
        "c3psn": [
          1,
          1
        ],
        "tacclim": [
          253.15,
          258.15
        ],
        "dpai": [
          [
            0.3,
            0.25,
            0.2,
            0.15,
            0.1
          ],
          [
            0.35,
            0.3,
            0.25,
            0.2,
            0.15
          ]
        ],
        "kb": [
          [
            0.5,
            0.5,
            0.5,
            0.5,
            0.5
          ],
          [
            0.5,
            0.5,
            0.5,
            0.5,
            0.5
          ]
        ],
        "tbi": [
          [
            0.92,
            0.84,
            0.77,
            0.71,
            0.65
          ],
          [
            0.91,
            0.83,
            0.76,
            0.69,
            0.63
          ]
        ],
        "fracsun": [
          [
            0.78,
            0.68,
            0.58,
            0.48,
            0.38
          ],
          [
            0.76,
            0.66,
            0.56,
            0.46,
            0.36
          ]
        ],
        "clump_fac": [
          0.88,
          0.86
        ],
        "ncan": [
          5,
          5
        ],
        "lai": [
          1.0,
          1.25
        ],
        "sai": [
          0.3,
          0.35
        ],
        "params": null,
        "validate": true
      },
      "metadata": {
        "type": "edge",
        "description": "Extreme cold temperatures (-20\u00b0C to -15\u00b0C), boreal/arctic conditions",
        "edge_cases": [
          "extreme_cold",
          "low_temperature_acclimation"
        ]
      }
    },
    {
      "name": "test_edge_extreme_hot_temperature",
      "inputs": {
        "vcmaxpft": [
          90.0,
          85.0
        ],
        "c3psn": [
          0,
          0
        ],
        "tacclim": [
          313.15,
          318.15
        ],
        "dpai": [
          [
            0.7,
            0.6,
            0.5,
            0.4,
            0.3
          ],
          [
            0.8,
            0.7,
            0.6,
            0.5,
            0.4
          ]
        ],
        "kb": [
          [
            0.6,
            0.6,
            0.6,
            0.6,
            0.6
          ],
          [
            0.65,
            0.65,
            0.65,
            0.65,
            0.65
          ]
        ],
        "tbi": [
          [
            0.87,
            0.76,
            0.66,
            0.57,
            0.5
          ],
          [
            0.85,
            0.72,
            0.61,
            0.52,
            0.44
          ]
        ],
        "fracsun": [
          [
            0.68,
            0.58,
            0.48,
            0.38,
            0.28
          ],
          [
            0.65,
            0.55,
            0.45,
            0.35,
            0.25
          ]
        ],
        "clump_fac": [
          0.7,
          0.72
        ],
        "ncan": [
          5,
          5
        ],
        "lai": [
          2.5,
          3.0
        ],
        "sai": [
          0.7,
          0.8
        ],
        "params": null,
        "validate": true
      },
      "metadata": {
        "type": "edge",
        "description": "Extreme hot temperatures (40-45\u00b0C), C4 desert/savanna conditions",
        "edge_cases": [
          "extreme_heat",
          "high_temperature_acclimation",
          "c4_pathway"
        ]
      }
    },
    {
      "name": "test_edge_full_shade_no_sunlit",
      "inputs": {
        "vcmaxpft": [
          55.0
        ],
        "c3psn": [
          1
        ],
        "tacclim": [
          290.15
        ],
        "dpai": [
          [
            0.4,
            0.35,
            0.3,
            0.25,
            0.2
          ]
        ],
        "kb": [
          [
            0.8,
            0.8,
            0.8,
            0.8,
            0.8
          ]
        ],
        "tbi": [
          [
            0.1,
            0.05,
            0.02,
            0.01,
            0.0
          ]
        ],
        "fracsun": [
          [
            0.15,
            0.08,
            0.03,
            0.01,
            0.0
          ]
        ],
        "clump_fac": [
          0.6
        ],
        "ncan": [
          5
        ],
        "lai": [
          1.5
        ],
        "sai": [
          0.4
        ],
        "params": null,
        "validate": true
      },
      "metadata": {
        "type": "edge",
        "description": "Deep shade conditions with minimal sunlit fraction in lower canopy",
        "edge_cases": [
          "minimal_sunlit",
          "high_extinction",
          "deep_shade"
        ]
      }
    },
    {
      "name": "test_special_variable_layer_counts",
      "inputs": {
        "vcmaxpft": [
          60.0,
          50.0,
          70.0,
          45.0
        ],
        "c3psn": [
          1,
          0,
          1,
          1
        ],
        "tacclim": [
          293.15,
          298.15,
          288.15,
          295.15
        ],
        "dpai": [
          [
            0.8,
            0.6,
            0.4,
            0.2,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0
          ],
          [
            0.5,
            0.4,
            0.3,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0
          ],
          [
            1.0,
            0.9,
            0.8,
            0.7,
            0.6,
            0.5,
            0.4,
            0.3,
            0.2,
            0.1,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0
          ],
          [
            0.3,
            0.2,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0
          ]
        ],
        "kb": [
          [
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5,
            0.5
          ],
          [
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55,
            0.55
          ],
          [
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48,
            0.48
          ],
          [
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52,
            0.52
          ]
        ],
        "tbi": [
          [
            0.89,
            0.79,
            0.7,
            0.62,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0
          ],
          [
            0.92,
            0.84,
            0.77,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0
          ],
          [
            0.86,
            0.74,
            0.64,
            0.55,
            0.47,
            0.4,
            0.34,
            0.29,
            0.25,
            0.21,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0
          ],
          [
            0.94,
            0.88,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0
          ]
        ],
        "fracsun": [
          [
            0.72,
            0.62,
            0.52,
            0.42,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0
          ],
          [
            0.75,
            0.65,
            0.55,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0
          ],
          [
            0.68,
            0.58,
            0.5,
            0.43,
            0.37,
            0.32,
            0.27,
            0.23,
            0.2,
            0.17,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0
          ],
          [
            0.78,
            0.7,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0,
            1.0
          ]
        ],
        "clump_fac": [
          0.85,
          0.75,
          0.8,
          0.9
        ],
        "ncan": [
          4,
          3,
          10,
          2
        ],
        "lai": [
          2.0,
          1.2,
          5.0,
          0.5
        ],
        "sai": [
          0.6,
          0.3,
          1.5,
          0.15
        ],
        "params": null,
        "validate": true
      },
      "metadata": {
        "type": "special",
        "description": "Four patches with different active layer counts (2, 3, 4, 10) using max 20-layer array",
        "edge_cases": [
          "variable_ncan",
          "padded_arrays"
        ]
      }
    },
    {
      "name": "test_special_uniform_vs_clumped_canopy",
      "inputs": {
        "vcmaxpft": [
          65.0,
          65.0,
          65.0
        ],
        "c3psn": [
          1,
          1,
          1
        ],
        "tacclim": [
          293.15,
          293.15,
          293.15
        ],
        "dpai": [
          [
            0.6,
            0.5,
            0.4,
            0.3,
            0.2
          ],
          [
            0.6,
            0.5,
            0.4,
            0.3,
            0.2
          ],
          [
            0.6,
            0.5,
            0.4,
            0.3,
            0.2
          ]
        ],
        "kb": [
          [
            0.5,
            0.5,
            0.5,
            0.5,
            0.5
          ],
          [
            0.5,
            0.5,
            0.5,
            0.5,
            0.5
          ],
          [
            0.5,
            0.5,
            0.5,
            0.5,
            0.5
          ]
        ],
        "tbi": [
          [
            0.9,
            0.8,
            0.7,
            0.6,
            0.5
          ],
          [
            0.9,
            0.8,
            0.7,
            0.6,
            0.5
          ],
          [
            0.9,
            0.8,
            0.7,
            0.6,
            0.5
          ]
        ],
        "fracsun": [
          [
            0.75,
            0.65,
            0.55,
            0.45,
            0.35
          ],
          [
            0.75,
            0.65,
            0.55,
            0.45,
            0.35
          ],
          [
            0.75,
            0.65,
            0.55,
            0.45,
            0.35
          ]
        ],
        "clump_fac": [
          1.0,
          0.7,
          0.5
        ],
        "ncan": [
          5,
          5,
          5
        ],
        "lai": [
          2.0,
          2.0,
          2.0
        ],
        "sai": [
          0.6,
          0.6,
          0.6
        ],
        "params": null,
        "validate": true
      },
      "metadata": {
        "type": "special",
        "description": "Three identical canopies with different clumping factors (uniform=1.0, moderate=0.7, highly clumped=0.5)",
        "edge_cases": [
          "clumping_comparison",
          "uniform_canopy",
          "highly_clumped"
        ]
      }
    }
  ],
  "notes": "Test data generation strategy:\n\n1. **Nominal cases (tests 1-3)**: Cover typical operational scenarios with physically realistic values. Vcmax25 ranges 40-80 umol/m2/s (typical for vegetation), temperatures 283-303K (10-30\u00b0C), LAI 1-7 m2/m2, 5-10 canopy layers. Mixed C3/C4 pathways to test both photosynthetic types.\n\n2. **Edge cases (tests 4-8)**: \n   - Zero LAI/SAI: Tests bare ground conditions\n   - Minimal LAI: Tests sparse vegetation with single layer\n   - Extreme cold (253-258K / -20 to -15\u00b0C): Tests boreal/arctic conditions and temperature acclimation\n   - Extreme heat (313-318K / 40-45\u00b0C): Tests desert/tropical conditions with C4 plants\n   - Deep shade: Tests high extinction coefficients and minimal sunlit fractions\n\n3. **Special cases (tests 9-10)**:\n   - Variable layer counts: Tests handling of different ncan values with padded arrays (common in batch processing)\n   - Clumping comparison: Tests effect of foliage clumping factor on nitrogen distribution\n\n**Physical constraints enforced**:\n- All temperatures > 0K (absolute zero)\n- Fractions (tbi, fracsun, clump_fac) in [0,1]\n- Non-negative values for LAI, SAI, dpai, kb, vcmaxpft\n- c3psn binary (0 or 1)\n- Consistent array dimensions within each test\n- dpai values sum approximately to LAI+SAI per patch\n- tbi decreases monotonically through canopy (increasing cumulative extinction)\n- fracsun decreases through canopy (less direct beam penetration)\n\n**Array padding**: For variable ncan tests, unused layers are padded with zeros (dpai) or ones (tbi, fracsun) to maintain array shape while being physically neutral.\n\n**Validation enabled**: All tests use validate=True to check numerical integration accuracy."
}